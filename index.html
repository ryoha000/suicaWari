<button id="start-btn">start</button>
<button id="stop-btn">stop</button>
<div id="result-div"></div>
<div id="container">
  <img src="suica.png" id="suica"/>
  <img src="chara.png" id="chara"/>
  <div id="game-result"></div>
</div>

<script>
  const startBtn = document.querySelector('#start-btn');
  const stopBtn = document.querySelector('#stop-btn');
  const resultDiv = document.querySelector('#result-div');
  const gameResult = document.querySelector('#geme-result');
  const chara = document.getElementById("chara");

  SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
  const recognition = new SpeechRecognition();

  recognition.lang = 'ja-JP';
  recognition.continuous = true;

  let finalTranscript = ''; // 確定した(黒の)認識結果
  let rotateY = 0
  chara.style.left = window.innerWidth / 2

  recognition.onresult = (event) => {
    let interimTranscript = ''; // 暫定(灰色)の認識結果
    for (let i = event.resultIndex; i < event.results.length; i++) {
      let transcript = event.results[i][0].transcript;
      if (event.results[i].isFinal) {
        finalTranscript += transcript;
      }
    }
    const maeCount = (finalTranscript.match(/(まえ|前)/g) || [] ).length;
    const ushiroCount = (finalTranscript.match( /(うしろ|後ろ)/g ) || [] ).length;
    const migiCount = (finalTranscript.match( /(みぎ|右)/g ) || [] ).length;
    const hidariCount = (finalTranscript.match( /(ひだり|左)/g ) || [] ).length;
    const soko = finalTranscript.match( /そこ/g );
    // if (!!maeCount + !!ushiroCount + !!migiCount + !!hidariCount !== 1) {
    //   gameResult.innerHTML = "一気にいっぱい言わないでよ！"
    //   setTimeout(() => {
    //     gameResult.innerHTML = ""
    //   }, 0.5);
    //   return
    // }
    const position = {x: chara.style.right, y: chara.style.bottom}
    console.log('mae', maeCount)
    console.log('migi', migiCount)
    if (migiCount > 0) {
      rotateY += 90
      chara.style.transform = `rotateX(${rotateY}deg)`
    } else if (hidariCount > 0) {
      rotateY -= 90
      chara.style.transform = `rotateY(${rotateY}deg)`
    }
    chara.style.bottom = maeCount * 75 + +position.y
    resultDiv.innerHTML = finalTranscript;
    finalTranscript = ''
  }

  startBtn.onclick = () => {
    recognition.start();
  }
  stopBtn.onclick = () => {
    recognition.stop();
  }
</script>

<style>
  #container {
    background-color: burlywood;
    position: relative;
    height: 100%;
    width: 100%;
  }
  #suica {
    position: absolute;
    top: 10%;
    right: 50%;
    z-index: 1;
  }
  #chara {
    position: absolute;
    bottom: 0;
    left: 50%;
    z-index: 2;
  }
  #game-result {
    font-size: 100px;
    position: absolute;
    bottom: 50%;
    right: 50%;
    z-index: 3;
  }
</style>